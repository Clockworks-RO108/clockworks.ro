---
import { getCollection } from "astro:content";
import { ArrowRight } from "lucide-react";

import {
	Card,
	Center,
	Grid,
	Link,
	Section as SectionLayout,
	Text,
	VStack,
} from "~/components/ui";
import { getTranslations, toLocale } from "~/lib";
import { filterLatestPost } from "~/lib/filters";
import { sortByDate } from "~/lib/sort";

const lang = toLocale(Astro.params.lang);

const latestPost = await getCollection("blog", filterLatestPost(lang))
	.then(sortByDate)
	.then((x) => x[0]);

if (!latestPost) throw new Error("unreachable");

const t = getTranslations(lang);

const href = `/${lang}/blog/${latestPost.slug.slice(3)}`;
---

<SectionLayout className="relative mt-32 h-auto">
	<Grid
		cols={3}
		stretch="width"
		className="z-10 mx-6 gap-4 lg:aspect-[5/2] lg:h-[55vh] lg:max-w-min lg:grid-rows-2"
	>
		<Card.Root
			variant="alternative"
			shape="square"
			className="col-span-full lg:col-span-1 lg:row-span-1"
		>
			<Center className="relative z-[9] my-auto">
				<Text.H2
					gradient="to-top"
					align="center"
					className="z-[12] inline-block from-off-white-300 to-off-white-100"
				>
					<!-- TODO translate -->
					 Colegiul National Gh. Sincai
				</Text.H2>
				<span class="absolute -top-2 left-12 -rotate-6 text-lg lg:left-16 lg:text-2xl">
					💚
				</span>
				<span class="absolute bottom-0 right-10 rotate-12 text-4xl lg:right-20">🤑</span>
				<span
					class="absolute -top-1 right-20 z-[-1] rotate-3 text-xl lg:right-24 lg:text-2xl"
				>
					🐸
				</span>
				<span
					class="absolute bottom-4 left-20 -rotate-6 text-xl lg:bottom-3 lg:left-20 lg:text-3xl"
				>
					🤩
				</span>
			</Center>
		</Card.Root>

		<Card.Root
			variant="alternative"
			shape="square"
			className="col-span-full lg:col-span-1 lg:row-span-2"
		>
			un chat sa mimam o colaborare in echipa? Also link catre about
		</Card.Root>

		<Card.Root
			variant="alternative"
			shape="square"
			className="col-span-full row-span-2 lg:col-span-1"
		>
			<!-- TODO get latest blog post -->
			<Card.Header>
				<Text.H3>{t("index.section-4.latest-article")}</Text.H3>
			</Card.Header>
			<Card.Content
				variant="alternative"
				className="aspect-square bg-gradient-to-b from-dark-blue-800 to-background"
			>
				<Link.Nav href={href}>
					<VStack stretch="all" alignment="start/between" className="p-4">
						<Text.H3 transition:name={`blog-title__${latestPost.slug}`}>
							{latestPost.data.title}
						</Text.H3>
						<VStack className="gap-2">
							<Text.Small className="mt-4 text-xs xl:text-sm">
								{latestPost.data.description}
							</Text.Small>
							<ArrowRight />
						</VStack>
					</VStack>
				</Link.Nav>
			</Card.Content>
		</Card.Root>

		<Card.Root
			variant="alternative"
			shape="square"
			className="col-span-full row-span-1 bg-gradient-to-br from-brand/90 to-brand-secondary/90 lg:col-span-1"
		>
			nu stiu
		</Card.Root>
	</Grid>
</SectionLayout>
